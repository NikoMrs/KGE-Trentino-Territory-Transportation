PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX etype: <http://knowdive.disi.unitn.it/etype#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

# 3.3 (Anna): Are there any routes on the “P.Dante Rosmini S.Rocco Povo Polo Soc.” line that go directly to “Povo Polo Sociale”?

select ?trip ?line_number ?arrival_name where {

    # Filter the line by name
    ?line etype:line_long_name ?line_name .
    ?line etype:line_short_name ?line_number .
    FILTER(CONTAINS(STR(?line_name), "Piazza Dante P.Fiera Povo Oltrecastello"))
    
    ?line etype:line_type ?line_type .
    ?line etype:composed_of ?trip .
    
	# Specify the arrival event
    ?trip etype:Contains ?arrival_event .
    
    # Filter the trips by direction
    ?trip etype:headsign ?headsign .
    ?trip etype:trip_direction ?trip_direction .
    FILTER(STR(?trip_direction) = "0")
    
	# Filter by arrival stop name
    ?arrival_stop etype:name ?arrival_name .
    FILTER(CONTAINS(STR(?arrival_name), "Povo \"Polo Sociale\" Cap."))
    									
    # Filter by day of the week 
    ?schedule etype:is_followed_by ?trip .
    ?schedule etype:byDay ?days .
    FILTER(CONTAINS(STR(?days), "thursday"))

   	# Connect the arrival stop with the stop event
    ?arrival_stop etype:is_location_for ?arrival_event .
    ?arrival_event etype:sequence_number ?arrival_sequence ;
            	   etype:arrival_time ?arrival_time .

} GROUP BY ?trip ?line_number ?arrival_name
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX etype: <http://knowdive.disi.unitn.it/etype#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

# 3.1 (Luisa): How do holiday schedules for busses and trains change on Christmas Day?
# Show trips not running normal service during Christmas Day with relative departure time

select ?trip ?line_name ?date ?departure_time where {

    ?line etype:line_short_name ?line_name .
    ?line etype:composed_of ?trip .
    
    # Mantain only the trips that are deleted for the Christmas Day
    ?schedule etype:is_followed_by ?trip .
    ?schedule etype:refers_to ?special_schedule .
    ?special_schedule etype:date ?date .
    FILTER((STR(?date) = "20241225" )) #YYYY-MM-DD
    
    # Connect the trips with the stop event and select anly the first stop event for every trip
    ?trip etype:Contains ?departure_event .
    ?departure_event etype:sequence_number ?departure_sequence ;
            		 etype:arrival_time ?departure_time .
    FILTER(STR(?departure_sequence) = "1")
    
} GROUP BY ?trip ?line_name ?date ?departure_time ORDER BY ?line_name ?departure_time limit 100